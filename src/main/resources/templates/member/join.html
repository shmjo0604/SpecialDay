<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>SPECIAL DAY : 회원가입</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!--웹 페이지 아이콘 변경-->
    <link rel="icon" th:href="@{/image/logo.ico}">
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=DynaPuff&family=Permanent+Marker&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500&display=swap" rel="stylesheet"> 
    <!--Bootstrap 용 CSS-->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!--CSS-->
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <!--Bootstrap 용 Icon CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <!--font awesome 용-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!--thymeleaf contextpath-->
    <link id="contextPathHolder" th:data-contextPath="${#httpServletRequest.getContextPath()}" />
    <style>
        /* .form-floating>.form-control {

            height: 100%;
        } */

        :root {
            --font-color: #4e4e4e;
            --main-color: #23ba15;

        }

        .d-grid {
            justify-content: center;
        }

        .d-grid>button {
            position: relative;
            width: 120px;
            height: 48px;
            font-size: 20px;
            background-color: var(--main-color);
            color: white;
            border: solid 1px var(--main-color);
        }

        .card {

            margin-left: 0px;
            border-color: #23ba15;
        }

        .logo-wrap img {
            width: 400px;
            height: 150px;
        }
    </style>
</head>

<body>

    <!--header 영역-->
    <header th:replace="~{header :: headerFragment}"></header>

    <!--main 영역-->
    <main>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-7">
                    <div class="card" style="border: 1px solid gainsboro; background-color: rgb(255, 255, 255);">

                        <div class="logo-wrap" style="text-align: center;  margin-top: 6%;  margin-bottom: 4%;">
                            <a th:href="@{/home.do}">
                                <img th:src="@{/image/logo.svg}" alt="로고 이미지" />
                            </a>
                        </div>
                        <!-- <h3 class="text-center font-weight-light my-4">회원 가입</h3> -->

                        <div class="card-body">
                            <form id="form" th:action="@{join.do}" method="post">
                                <div class="form-floating mb-4">
                                    <input class="form-control" id="id" type="text" placeholder="Enter your id"
                                        name="id" onkeyup="ajaxIdCheck(this)" />
                                    <label for="id" id="lbl_check" class="form-label">아이디</label>
                                </div>
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-4 mb-md-0">
                                            <input class="form-control" id="password" type="password" name="password"
                                                placeholder="Enter your password" maxlength="15"/>
                                            <label for="password">비밀번호</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input class="form-control" id="password1" type="password"
                                                placeholder="Enter your password" maxlength="15"/>
                                            <label for="password1">비밀번호 확인</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-floating mb-4">
                                    <input class="form-control" id="name" type="text" placeholder="Enter your name"
                                        name="name"/>
                                    <label for="name">성명</label>
                                </div>
                                <div class="form-floating mb-4">
                                    <input class="form-control" id="email" type="email" name="email"
                                        placeholder="Enter your name"/>
                                    <label for="name">이메일</label>
                                </div>
                                <div class="form-floating mb-4">
                                    <input class="form-control" id="phone" type="tel" name="phone"
                                        placeholder="Enter your phone" oninput="autoHyphen(this)"
                                        maxlength="13" />
                                    <label for="phone">전화번호(하이픈('-')은 자동 입력됩니다)</label>
                                </div>
                                <div class="form-floating mb-4">
                                    <input class="form-control" id="birth" type="text" name="birth"
                                        placeholder="Enter your birth" maxlength="6"/>
                                    <label for="birth">생년월일(앞 6자리를 입력해주세요)</label>
                                </div>
                                <div class="row mb-3">
                                    <div class="col d-flex">
                                        <div class="form-check me-3">
                                            <input class="form-check-input" type="radio" value="M" name="gender"
                                                checked>
                                            <label class="form-check-label" for="gender">남성</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" value="W" name="gender">
                                            <label class="form-check-label" for="gender">여성</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4 mb-0 d-flex justify-content-center">
                                    <button class="btn btn-primary me-2" type="button"
                                        onclick="joinAction()">회원가입</button>
                                    <a th:href="@{/home.do}" class="btn btn-outline-success float-right">홈으로</a>
                                </div>

                            </form>
                        </div>
                        <!-- <div class="card-footer text-center py-3">
                            <div class="small"><a th:href="@{/login.do}">로그인</a></div>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!--footer 영역-->
    <footer></footer>

    <!--jQuery-->
    <script th:src="@{/js/jquery-3.6.4.min.js}"></script>
    <!--axios library-->
    <script th:src="@{/js/axios.min.js}"></script>
    <!--Bootstrap 용 js -->
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <!--Main js-->
    <script th:src="@{/js/main.js}"></script>
    <script>
        const contextPath = $('#contextPathHolder').attr('data-contextPath');

        var idcheck = 0;

        function autoHyphen(target) {
            target.value = target.value
                .replace(/[^0-9]/g, '')
                .replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/g, "$1-$2-$3").replace(/(\-{1,2})$/g, "");
        }

        function joinAction() {
            const id = document.getElementById("id");
            const pw = document.getElementById("password");
            const pw1 = document.getElementById("password1");
            const name = document.getElementById("name");
            const email = document.getElementById("email");
            const phone = document.getElementById("phone");
            const gender = document.getElementsByName("gender");
            const birth = document.getElementById("birth");
            //console.log(gender);

            var emailregex = /^([0-9a-zA-Z_\.-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,2}$/;
            var pwregex = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,15}$/;

            if (id.value.length <= 0) {
                alert('아이디를 입력하세요');
                id.focus();
                return false;
            }
            if (pw.value.length <= 0) {
                alert('비밀번호를 입력하세요');
                pw.focus();
                return false;
            }
            if (pw1.value.length <= 0) {
                alert('비밀번호를 입력하세요');
                pw1.focus();
                return false;
            }
            if (!pwregex.test(pw.value)) {
                alert("비밀번호는 영문, 숫자, 특수문자 조합 8~15자이어야 합니다.");
                pw.focus();
                return false;
            }
            if (pw.value !== pw1.value) {
                alert('비밀번호가 일치하지 않습니다.');
                pw.focus();
                return false;
            }
            if (name.value.length <= 0) {
                alert('이름을 입력하세요');
                name.focus();
                return false;
            }
            if (email.value.length <= 0) {
                alert('이메일을 입력하세요');
                email.focus();
                return false;
            }
            if (!emailregex.test(email.value)) {
                alert('올바른 형식의 이메일이 아닙니다.');
                email.focus();
                return false;
            }
            if (phone.value.length <= 0) {
                alert('연락처를 입력하세요');
                phone.focus();
                return false;
            }
            if (birth.value.length <= 0) {
                alert('생년월일을 입력하세요');
                birth.focus();
                return false;
            }
            if (birth.value.length < 6) {
                alert('생년월일 6자리를 입력하세요');
                birth.focus();
                return false;
            }
            if (idcheck === 0) {
                alert('중복된 아이디 입니다.');
                id.focus();
                return false;
            }

            document.getElementById("form").submit();
        }

        async function ajaxIdCheck(e) {
            if (e.value.length > 0) {
                const url = contextPath + '/api/member/idcheck.json?id=' + e.value;
                const headers = { "Content-Type": "application/json" };
                const { data } = await axios.get(url, { headers });
                //console.log(data);

                if (data.ret === 1) {
                    idcheck = 0;
                    document.getElementById("lbl_check").innerText = '사용 불가능한 아이디입니다.';
                }
                else if (data.ret === 0) {
                    idcheck = 1;
                    document.getElementById("lbl_check").innerText = '사용 가능한 아이디입니다.';
                }
            }
            else {
                idcheck = 0;
                document.getElementById("lbl_check").innerText = '아이디';
            }
        }
    </script>
</body>

</html>